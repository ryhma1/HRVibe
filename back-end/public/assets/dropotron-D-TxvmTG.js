(function(i){i.fn.disableSelection_dropotron=function(){return i(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},i.fn.dropotron=function(u){if(this.length==0)return i(this);if(this.length>1)for(var e=0;e<this.length;e++)i(this[e]).dropotron(u);return i.dropotron(i.extend({selectorParent:i(this)},u))},i.dropotron=function(u){var e=i.extend({selectorParent:null,baseZIndex:1e3,menuClass:"dropotron",expandMode:"hover",hoverDelay:150,hideDelay:250,openerClass:"opener",openerActiveClass:"active",submenuClassPrefix:"level-",mode:"fade",speed:"fast",easing:"swing",alignment:"left",offsetX:0,offsetY:0,globalOffsetY:0,IEOffsetX:0,IEOffsetY:0,noOpenerFade:!0,detach:!0,cloneOnDetach:!0},u),d=e.selectorParent,p=d.find("ul"),x=i("body"),k=i("body,html"),h=i(window),a=!1,m=null,g=null;d.on("doCollapseAll",function(){p.trigger("doCollapse")}),p.each(function(){var t=i(this),o=t.parent();e.hideDelay>0&&t.add(o).on("mouseleave",function(s){window.clearTimeout(g),g=window.setTimeout(function(){t.trigger("doCollapse")},e.hideDelay)}),t.disableSelection_dropotron().hide().addClass(e.menuClass).css("position","absolute").on("mouseenter",function(s){window.clearTimeout(g)}).on("doExpand",function(){if(t.is(":visible"))return!1;window.clearTimeout(g),p.each(function(){var w=i(this);i.contains(w.get(0),o.get(0))||w.trigger("doCollapse")});var s,l,n,r,A=o.offset(),v=o.position(),C=(o.parent().position(),o.outerWidth()),c=t.outerWidth(),b=t.css("z-index")==e.baseZIndex;if(b){switch(s=e.detach?A:v,r=s.top+o.outerHeight()+e.globalOffsetY,l=e.alignment,t.removeClass("left").removeClass("right").removeClass("center"),e.alignment){case"right":n=s.left-c+C,0>n&&(n=s.left,l="left");break;case"center":n=s.left-Math.floor((c-C)/2),0>n?(n=s.left,l="left"):n+c>h.width()&&(n=s.left-c+C,l="right");break;case"left":default:n=s.left,n+c>h.width()&&(n=s.left-c+C,l="right")}t.addClass(l)}else switch(o.css("position")=="relative"||o.css("position")=="absolute"?(r=e.offsetY,n=-1*v.left):(r=v.top+e.offsetY,n=0),e.alignment){case"right":n+=-1*o.parent().outerWidth()+e.offsetX;break;case"center":case"left":default:n+=o.parent().outerWidth()+e.offsetX}navigator.userAgent.match(/MSIE ([0-9]+)\./)&&RegExp.$1<8&&(n+=e.IEOffsetX,r+=e.IEOffsetY),t.css("left",n+"px").css("top",r+"px").css("opacity","0.01").show();var f=!1;switch(n=o.css("position")=="relative"||o.css("position")=="absolute"?-1*v.left:0,t.offset().left<0?(n+=o.parent().outerWidth()-e.offsetX,f=!0):t.offset().left+c>h.width()&&(n+=-1*o.parent().outerWidth()-e.offsetX,f=!0),f&&t.css("left",n+"px"),t.hide().css("opacity","1"),e.mode){case"zoom":a=!0,o.addClass(e.openerActiveClass),t.animate({width:"toggle",height:"toggle"},e.speed,e.easing,function(){a=!1});break;case"slide":a=!0,o.addClass(e.openerActiveClass),t.animate({height:"toggle"},e.speed,e.easing,function(){a=!1});break;case"fade":if(a=!0,b&&!e.noOpenerFade){var f;f=e.speed=="slow"?80:e.speed=="fast"?40:Math.floor(e.speed/2),o.fadeTo(f,.01,function(){o.addClass(e.openerActiveClass),o.fadeTo(e.speed,1),t.fadeIn(e.speed,function(){a=!1})})}else o.addClass(e.openerActiveClass),o.fadeTo(e.speed,1),t.fadeIn(e.speed,function(){a=!1});break;case"instant":default:o.addClass(e.openerActiveClass),t.show()}return!1}).on("doCollapse",function(){return t.is(":visible")&&(t.hide(),o.removeClass(e.openerActiveClass),t.find("."+e.openerActiveClass).removeClass(e.openerActiveClass),t.find("ul").hide()),!1}).on("doToggle",function(s){return t.is(":visible")?t.trigger("doCollapse"):t.trigger("doExpand"),!1}),o.disableSelection_dropotron().addClass("opener").css("cursor","pointer").on("click touchend",function(s){a||(s.preventDefault(),s.stopPropagation(),t.trigger("doToggle"))}),e.expandMode=="hover"&&o.hover(function(s){a||(m=window.setTimeout(function(){t.trigger("doExpand")},e.hoverDelay))},function(s){window.clearTimeout(m)})}),p.find("a").css("display","block").on("click touchend",function(t){a||i(this).attr("href").length<1&&t.preventDefault()}),d.find("li").css("white-space","nowrap").each(function(){var t=i(this),o=t.children("a"),s=t.children("ul"),l=o.attr("href");o.on("click touchend",function(n){l.length==0||l=="#"?n.preventDefault():n.stopPropagation()}),o.length>0&&s.length==0&&t.on("click touchend",function(n){a||(d.trigger("doCollapseAll"),n.stopPropagation())})}),d.children("li").each(function(){var t,o=i(this),s=o.children("ul");if(s.length>0){e.detach&&(e.cloneOnDetach&&(t=s.clone(),t.attr("class","").hide().appendTo(s.parent())),s.detach().appendTo(x));for(var l=e.baseZIndex,n=1,r=s;r.length>0;n++)r.css("z-index",l++),e.submenuClassPrefix&&r.addClass(e.submenuClassPrefix+(l-1-e.baseZIndex)),r=r.find("> li > ul")}}),h.on("scroll",function(){d.trigger("doCollapseAll")}).on("keypress",function(t){a||t.keyCode!=27||(t.preventDefault(),d.trigger("doCollapseAll"))}),k.on("click touchend",function(){a||d.trigger("doCollapseAll")})}})(jQuery);
